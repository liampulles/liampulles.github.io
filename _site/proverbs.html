<!doctype html><html lang=en color-mode=light><meta charset=utf-8><title>Liam Pulles - Proverbs</title><meta name=description content=Proverbs><meta name=author content="Liam Pulles"><meta name=viewport content="width=device-width,initial-scale=1"><script>if(localStorage.getItem("color-mode")==="dark"||(window.matchMedia("(prefers-color-scheme: dark)").matches&&!localStorage.getItem("color-mode"))){document.documentElement.setAttribute("color-mode","dark");}</script><link rel=preconnect href=https://cdnjs.cloudflare.com><link href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fraunces" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@500" rel=stylesheet><link href=/style.css rel=stylesheet><link href=/tango.css rel=stylesheet><link href=/monokai.css rel=stylesheet><link href=/images/favicon.ico rel="shortcut icon" type=image/x-icon><header class=site-header><p><a href=/>Liam Pulles</a><nav><ul><li><a href=/biography>Biography</a><li><a href=/proverbs>Proverbs</a><li><a href=/code>Code</a></ul></nav><div class=color-mode__header><i class="color-mode__btn light--hidden fa-solid fa-sun fa-xl"></i><i class="color-mode__btn dark--hidden fa-solid fa-moon fa-xl"></i></div></header><main><article><hr><h1>Proverbs</h1><p>Over the years I discover small pieces of cogent advice about programming and being a developer that I find useful.<p>This page tries to collect those thoughts - for my benefit and perhaps others. Email me if you have something good, I'll consider adding it. ;)<section><h2>Code Design</h2><section><h3>Applying DRY: intrinsically vs. coincidentally similar code</h3><aside class=optional><figure><img src=images/proverbs/Applying%20DRY:%20intrinsically%20vs.%20coincidentally%20similar%20code.webp></figure></aside><p>In Uni I learned that you should NEVER have duplicated code. But in the workplace, I've learned from wise old devs and from firsthand experience that this is not always the case.<p>My philosophy is as follows: <b>Refactor intrinsically similar code - not coincidentally similar.</b><p>Coincidentally similar code is likely to change and differentiate. If you preemptively pull both sets of logic out into a common function, you'll later have to create parameters for differences, and you'll dirty your previously clean code.<p>An example of this might be a plain text template function and an HTML template function. While the initial implementation of these two functions is the same, the HTML function will need to be able to escape certain characters in the future - if you've pulled out a common function, you'll need now need to add a boolean argument to switch between HTML or plain text (which is ugly).<p>Intrinsically similar code NEEDS to be put in a common function, however. If you don't do this, you risk a business rule being inconsistently implemented.<p>An example of this is formatting dates as strings. If you identify two separate pieces (or even one piece) of code which use an anonymous string like "DD/MM/YYYY" to format a date, that should be pulled out into a global constant or date utility function. If you don't do this, you risk someone changing one of the format strings (or adding another anonymous one somewhere) to "MM/DD/YYYY" - and you'll end up confusing/misinforming your users and potentially making the client liable.<p>Determining whether similarities are coincidental or intrinsic is a matter of interrogating your domain, which is an essential part of the job of a developer anyway.</section><section><h3>Design by contract</h3><aside class=optional><figure><img src=images/proverbs/Design%20by%20contract.webp></figure></aside><p><i>Source: <a href=https://pragprog.com/titles/tpp20/the-pragmatic-programmer-20th-anniversary-edition/>The Pragmatic Programmer</a></i><p>Check that the input and output of important functions are sensible. This can be as simple as a few <code>assert</code> statements, e.g.<figure class=highlight><pre><code class=language-go data-lang=go><span class=n>public</span> <span class=n>sendSms</span><span class=p>(</span><span class=n>String</span> <span class=n>cell</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>assert</span> <span class=n>PhoneValidationUtil</span><span class=o>.</span><span class=n>ValidNumber</span><span class=p>(</span><span class=n>cell</span><span class=p>);</span>
   <span class=c>// ...</span>
<span class=p>}</span></code></pre></figure><p>Do this instead of defensive programming, and apply selectively - put it on your core business logic for specific variables; resources.<p>By doing this, you'll help minimize unexpected costly mistakes where bad data gets through to your business logic.</section></section><section><h2>Golang</h2><section><h3>Implementation checks</h3><aside class=optional><figure><img src=images/proverbs/Implementation%20checks.webp></figure></aside><p>Go has <i>structural typing</i>, so a type implements an interface if it defines the same method signatures.<p>While this can be useful for abstracting external types, it is often nice to be able to check at compile time that a type implements an interface.<p>A nice pattern I've seen for this is to assign an unnamed global variable of the interface type to an implementation instance, e.g.<figure class=highlight><pre><code class=language-go data-lang=go><span class=k>type</span> <span class=n>Hashable</span> <span class=k>interface</span> <span class=p>{</span>
    <span class=n>Hash</span><span class=p>()</span> <span class=p>[]</span><span class=kt>byte</span>
<span class=p>}</span>

<span class=k>type</span> <span class=n>BasicThingy</span> <span class=kt>string</span>
<span class=k>type</span> <span class=n>StructThingy</span> <span class=k>struct</span><span class=p>{}</span>

<span class=c>// Implementation checks:</span>
<span class=k>var</span> <span class=n>_</span> <span class=n>Hashable</span> <span class=o>=</span> <span class=p>(</span><span class=n>BasicThingy</span><span class=p>)(</span><span class=s>""</span><span class=p>)</span>
<span class=k>var</span> <span class=n>_</span> <span class=n>Hashable</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>StructThingy</span><span class=p>{}</span></code></pre></figure><p>Here we check that BasicThingy and *StructThingy implement Hashable. If they don't, the compiler will generate a nice error message pointing at the assignment. For this reason, it is nice to put this assignment next to the implementation type declaration.</section><section><h3>You don&#39;t need a dependency injection library</h3><p>If you follow the Service pattern from DDD, then you'll have a number of services which transitively depend on each other. Typically, you'll use some dependency injection container or wiring library to have these services be connected upon startup.<p></p>But there's no reason you can't do this wiring yourself:<figure class=highlight><pre><code class=language-go data-lang=go><span class=k>func</span> <span class=n>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>server</span> <span class=o>:=</span> <span class=n>Wire</span><span class=p>()</span>
    <span class=n>server</span><span class=o>.</span><span class=n>Run</span><span class=p>()</span>
<span class=p>}</span>
  
<span class=k>func</span> <span class=n>Wire</span><span class=p>()</span> <span class=o>*</span><span class=n>http</span><span class=o>.</span><span class=n>Server</span> <span class=p>{</span>
    <span class=n>cfgProvider</span> <span class=o>:=</span> <span class=n>config</span><span class=o>.</span><span class=n>NewProvider</span><span class=p>()</span>
    <span class=n>svc</span> <span class=o>:=</span> <span class=n>usecase</span><span class=o>.</span><span class=n>NewService</span><span class=p>(</span><span class=n>cfgProvider</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=n>NewServer</span><span class=p>(</span><span class=n>cfgProvider</span><span class=p>,</span> <span class=n>svc</span><span class=p>)</span>
<span class=p>}</span></code></pre></figure><p>Advantages: you don't need to depend on an external library, if it compiles then you know everything is wired, and you can have custom Wire functions which e.g. substitute external client services with mock versions for integration tests.<p>It is very convenient for small projects.</section></section><section><h2>Makefiles</h2><section><h3>Tool check and install</h3><aside class=optional><figure><img src=images/proverbs/Tool%20check%20and%20install.webp></figure></aside><p>Often as part of your Makefile, you'll have directives which run dev tools to do things like lint your code, generate mocks, etc. What you may not be aware of is that - provided your dev tool can be installed via the shell - you can automate the installation of these tools when the directives are run for the first time. This makes it trivial for new starters on the repo to get up and going.<p>Here's an example for a Go tool:<figure class=highlight><pre><code class=language-make data-lang=make><span class=nv>GOBIN</span> <span class=o>:=</span> <span class=p>$(</span>shell go <span class=nb>env </span>GOPATH<span class=p>)</span>/bin

<span class=nl>inspect</span><span class=o>:</span> <span class=nf>$(GOBIN)/golangci-lint</span>
	<span class=p>$(</span>GOBIN<span class=p>)</span>/golangci-lint run
  
<span class=nl>$(GOBIN)/golangci-lint</span><span class=o>:</span>
	<span class=p>$(</span>MAKE<span class=p>)</span> install-golangci-lint
<span class=nl>install-golangci-lint</span><span class=o>:</span>
	curl <span class=nt>-sSfL</span> https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh <span class=nt>-s</span> <span class=nt>--</span> <span class=nt>-b</span> <span class=p>$(</span>GOBIN<span class=p>)</span> v1.46.2
	<span class=nb>rm</span> <span class=nt>-rf</span> ./v1.46.2</code></pre></figure><p>If you run inspect, Make will check if a file at $(GOBIN)/golangci-lint exists. If it does not, the associated directive will be executed, which then leads to the install directive being executed, and finally whatever shell commands are needed to install the program are run.<p>Another benefit of this abstraction is that if you update the tool, you can just advise the team to run <code>make install-golangci-lint</code> manually.</section></section></article></main><footer><p><b>Comments? Send me an <a href="mailto:me@liampulles.com?subject=With regards to your %22Liam Pulles - Proverbs%22 page">email</a>. Or, share this piece:</b><p><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fliampulles.com%2Fproverbs.html" aria-label="Share on Twitter" target=_blank><i class="fa-brands fa-square-twitter fa-xl"></i></a><a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fliampulles.com%2Fproverbs.html" aria-label="Share on LinkedIn" target=_blank><i class="fa-brands fa-linkedin fa-xl"></i></a><a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fliampulles.com%2Fproverbs.html" aria-label="Share on Hacker News" target=_blank><i class="fa-brands fa-square-hacker-news fa-xl"></i></a><a href="http://reddit.com/submit?url=https%3A%2F%2Fliampulles.com%2Fproverbs.html" aria-label="Share on Reddit" target=_blank><i class="fa-brands fa-square-reddit fa-xl"></i></a><a href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Fliampulles.com%2Fproverbs.html" aria-label="Share on Facebook" target=_blank><i class="fa-brands fa-square-facebook fa-xl"></i></a><a href="mailto:someone@somewhere.com?subject=Check out this article&body=https://liampulles.com/proverbs.html" aria-label="Share via Email"><i class="fa-solid fa-square-envelope fa-xl"></i></a><p>© 2023 Liam Pulles.</footer><script src=/script.js></script>